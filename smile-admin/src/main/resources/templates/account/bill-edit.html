<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<meta charset="utf-8">
<head th:include="include :: header">
  <link th:href="@{/libs/datapicker/datepicker3.css}" rel="stylesheet"/>
</head>
<body class="white-bg">

<div class="wrapper wrapper-content animated fadeInRight ibox-content">

  <form class="form-horizontal m" id="form-system-bill-edit" method="post" th:object="${familyAccountBill}">

    <input type="hidden" name="billId" th:value="*{billId}">
    <div class="form-group">
      <label class="col-sm-3 control-label">账单日期：</label>
      <div class="col-sm-8">
        <input class="form-control" id="billDate" name="billDate" type="text" th:value="*{billDate}"/>
      </div>
    </div>

    <div class="form-group">
      <label class="col-sm-3 control-label">大类：</label>
      <div class="col-sm-8">
        <select name="category" class="form-control m-b" th:field="*{category}">
          <option value="">--请选择--</option>
          <option th:each="category,userStat:${categorys}" th:value="${category.value}" th:text="${category.name}" th:data="${category.id}"></option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label class="col-sm-3 control-label">小类：</label>
      <div class="col-sm-8">
        <select name="subcategory" class="form-control m-b" th:field="*{subcategory}">
        </select>
      </div>
    </div>

    <div class="form-group">
      <label class="col-sm-3 control-label">收支方向：</label>
      <div class="col-sm-8">
        <select name="direction" class="form-control m-b" th:field="*{direction}">
          <option value="00">支出</option>
          <option value="01">收入</option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label class="col-sm-3 control-label">金额：</label>
      <div class="col-sm-8">
        <input class="form-control" name="amount" type="number" th:value="*{amount}" min="0"/>
      </div>
    </div>

    <div class="form-group">
      <label class="col-sm-3 control-label">备注：</label>
      <div class="col-sm-8">
        <input class="form-control" name="remark" type="text" th:value="*{remark}"/>
      </div>
    </div>

  </form>

</div>

<div th:include="include::footer"></div>

<script th:src="@{/libs/datapicker/bootstrap-datepicker.js?v=2.0}"></script>
<script type="text/javascript">
    function submitHandler() {

        var data = {};

        $('#form-system-bill-edit').serializeArray().map(function (x) {
            if (data[x.name] == undefined) {
                data[x.name] = x.value;
            } else {
                data[x.name].push(x.value);
            }
        })

        $.ajax({
            url: ctx + 'account/bill/edit',
            type: 'POST',
            data: data,
            success: function (result) {
                $.operate.successCallback(result);
            },
            error: function (err) {
                $.modal.alertError("系统错误");
            }
        });
    }

    $(function () {

        $("#billDate").datepicker({
            language: "zh-CN"
        });

        $("select[name='category']").change(function () {
            // 获取被选中的值
            var category = $(this).children('option:selected').attr("data");

            $.ajax({
                url: ctx + 'system/dictionary/get',
                type: 'POST',
                data: {"parentId": category, "groupId":"1"},
                success: function (result) {
                    var subcategory = "";
                    for (r of result) {
                        subcategory += "<option value='"+r.value+"'>"+r.name+"</option>"
                    }
                    $("select[name='subcategory']").html(subcategory);
                },
                error: function (err) {
                    $.modal.alertError("系统错误");
                }
            });

        });

    });

</script>

</body>
</html>